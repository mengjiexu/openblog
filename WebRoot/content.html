<!DOCTYPE html>
<html>
<head>
<title>Blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="keywords" content="Bolg" />

<link href="css/bootstrap.css" rel='stylesheet' type='text/css' />
<link href="css/style.css" rel="stylesheet" type="text/css" media="all" />
</head>
<body>
 <!--导航栏-->
 <div class="header">
  <div class="header-bottom">
   <div class="navigation">
	<nav class="navbar navbar-default" role="navigation">
     <div class="wrap">
	  <div class="navbar-header">
		<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#collapse-1">
			<span class="sr-only">T</span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
		</button>
	  </div>
	  <div class="collapse navbar-collapse" id="collapse-1">
	   <ul class="nav navbar-nav navbar-right">
		 <li><a href="index.html">首页</a></li>
		 <li id="login"><a data-toggle="modal" data-target="#sigModal">登陆</a></li>
		 <li id="selfinfo" class="dropdown" style="display:none;">
			<a href="javascript:void(0);" class="dropdown-toggle" data-toggle="dropdown">个人中心<b class="caret"></b></a>
			<ul class="dropdown-menu">
				<li><a href="./person.html">个人信息</a></li>
				<li class="divider"></li>
				<li><a href="./writeBlog.html">书写博客</a></li>
				<li class="divider"></li>
				<li><a href="./myBlog.html">管理博客</a></li>
				<li class="divider"></li>
				<li><a href="javascript:void(0);" onClick="logout();">退出</a></li>
			</ul>
		  </li>
		</ul>
	   </div>
	  </div>
     </nav>
	</div>
   </div>
  </div>
  <!-- end 导航栏-->
 
  <!--主体-->
  <div class="main-body">
   <div class="wrap">
    <div style="margin-top: 20px;">
     <!--博主-->	
     <div class="col-md-3 content-left" style="padding:0 40px 0 40px;">
	  <div class="popular-news">
	   <header>
		<h3 class="title-popular">博主</h3>
	   </header>
	    <div class="text-center" style="padding: 10px 0 10px 10px;">
		 <img id="bloggerImg" class="img-circle" src="images/bus3.jpg" alt="" />
		 <h4 style="padding: 10px 0 10px 10px;">
			<span id="bloggerName" class="label label-info"></span>
		 </h4>
		</div>
		<div style="display: flex; flex-direction: row; padding: 10px 0 10px 10px;">
			<div class="col-md-3">
			  <a class="btn btn-default" href="javascript:void(0);" onClick="dashang();" data-toggle="tooltip" data-placement="top" title="点击一次打赏1积分"><img src="img/money.ico"/></a>
			</div>
			<div class="col-md-3">
			<a class="btn btn-default" href="#writecomment" data-toggle="tooltip" data-placement="top" title="留言"><img src="img/letter.ico"/></a>
			</div>
			<div class="col-md-3">
			<a class="btn btn-default" href="javascript:void(0);" data-toggle="tooltip" data-placement="top" title="点赞" onClick="dianzan();" ><img src="img/like.ico"/></a>
			</div>
			<div class="col-md-3">
			  <a class="btn btn-default" href="#writecomment" data-toggle="tooltip" data-placement="top" title="私信"><img src="img/message.ico"/></a>
			</div>
		</div>
		<div class="text-center">
		 <p id="world"></p>
		</div>
	   </div>
	  </div>
	  <!--博文 -->
	 <div class="col-md-9">
	   <div class="about">
		<div class="wrap">
		 <div class="move-text" style="padding: 30px 30px 5px 30px;">
		  <div class="text-center">
		   <h3 id="title"></h3>
		  </div>
	      <div class="text-left">
			 <p>
				<span class="glyphicon glyphicon-comment"></span><b id="discussNum"></b>
				<span class="glyphicon glyphicon-eye-open"></span><b id="viewNum"></b> 
				<span class="glyphicon glyphicon-thumbs-up"></span><b id="likeNum"></b>
				<span class="glyphicon glyphicon-time"></span><b id="subTime"></b>
			 </p>
		  </div>
		 </div>
	    </div>
	    <!--正文-->
	    <div id="articlecontent">
	    </div>
		<!--评论-->
		<div class="response" id="writecomment" style="border:1px  solid #D5D5D5 ;">
	      <h4>评论
			  <button class="btn btn-info pull-right" data-toggle="collapse" href="#editPanel">
	          <i class="glyphicon glyphicon-edit"></i>写评论</button>
		  </h4>
		  <div id="editPanel" class="panel-collapse collapse">
	         <div class="panel-body">
	          <div class="form-group">
	             <textarea id="discussContent" class="form-control" rows="4"></textarea>
	          </div>
	          <button class="btn btn-success" onclick="addDiscuss()">发表</button>
	          <button class="btn btn-default" data-toggle="collapse" href="#editPanel">取消</button>
	        </div>
          </div>
		 <div id="discussList" class="media response-info"></div>
		</div>
	   </div>
	  </div>
	  <div class="clearfix"></div>
	</div>		
	</div>
	</div>
	<!-- end 主版-->
	
	<!-- footer -->
	<div class="footer">
		<div class="footer-bottom">
			<div class="text-center">
				<p style="color: white;">Copyright &copy;开源博客开发小组</p>
			</div>
		</div>
	</div>
<div class="modal fade" id="sigModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
     <div class="modal-dialog">
      <div class="modal-content">
         <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h3>&nbsp;</h3>
         </div>
         
          <div class="modal-body" style="background-color: #edeff1;">
			<div class="row">
				<!--登陆-->
			  <div class="col-md-6">
			  	<div id="loginByPass">
				 <div class="text-center">
				   <img src='img/face.ico' alt='人脸登录' onclick="loginByFace()"/>
			     </div>
				 <div class="form-group">
				    <label for="Email">邮箱</label>
				    <input type="email" class="form-control" id="userEmail" placeholder="email">
				  </div>
				  <div class="form-group">
				    <label for="Password">密码</label>
				    <input type="password" class="form-control" id="userPassword" placeholder="Password">
				  </div>
				  <div id="loginMessage"></div>
				  <button class="btn btn-primary btn-block" onclick="doLogin()">登录</button>
				  </div>
				  <div id="loginByFace" class="form-group" style="margin-top:10px; display: none;">
				  <div style="background-color: #000000; border: groove; height:185px;width: 100%; margin-bottom: 10px;">
				   </div> 
				   <button class="btn btn-default btn-block" onclick="canelFace()">取消</button>
				  </div>
				</div>
				<!--注册-->
				<div class="col-md-6" style="border-left: 2px solid white;">
					<div id="register">
				  <div class="text-center" style="padding: 5px 0 10px 0;">
				   <h3>注册</h3>
			      </div>
				   
				  <div class="form-group">
				  	<div id="re_email_message"></div>
				    <div class="input-group">
				      <div class="input-group-addon">
				      	<i class="glyphicon glyphicon-cloud"></i>
				      </div>
				      <input id="re_email" class="form-control" type="text" placeholder="email">
				    </div>
				   </div>
				  <div class="form-group">
				  	<div id="re_name_message"></div>
				    <div class="input-group">
				      <div class="input-group-addon">
				      	<i class="glyphicon glyphicon-user"></i>
				      </div>
				      <input id="re_name" class="form-control" type="text" placeholder="用户名">
				    </div>
				   </div>
				   <div class="form-group">
				    <div id="re_password_message"></div>
				    <div class="input-group">
				      <div class="input-group-addon">
				      	<i class="glyphicon glyphicon-lock"></i>
				      </div>
				      <input id="re_password" class="form-control" type="password" placeholder="密码(8~16位)">
				    </div>
				  </div>
			      <button class="btn btn-danger btn-block" onclick="doRegister()">注册</button>
			      </div>
			      <div id="findPass" style="display: none;">
			       <div class="text-center">
				   <h4>找回密码</h4>
			     </div>
				 <div class="form-group">
				    <label for="Email">邮箱</label>
				    <input type="email" class="form-control" id="find_Email" placeholder="email">
				  </div>
				  <button class="btn btn-success" onclick="subFind()">找回</button>
				  <button class="btn btn-default" onclick="cancelFind()">取消</button>
				  
				  </div>
				</div>
			</div>
         </div>
         <div  class="modal-footer">
          <button class="btn btn-default pull-left" onclick="doFind()">忘记密码?</button>
         </div>
      </div>
   </div>
   </div>
<script type="text/javascript" src="js/jquery.min.js" ></script>
<script type="text/javascript" src="js/bootstrap.js" ></script>
<script type="text/javascript" src="js/sigin.js" ></script>
<script type="text/javascript">
var dianzanstate=0;
var discusslen = 0;
$(document).ready(function(){
	loadDiscuss();
	loadBlogContent();
	loadBlogger();
	$("[data-toggle='tooltip']").tooltip();
})
function loadDiscuss(){
$.getJSON("comment_getallcommentbyaid?aid="+GetUrlParms()["aid"],
	function(data){
		discusslen = data.length;
		for(var i=0;i<data.length;i++){
			var username = "";
			$.getJSON("./user_getbloggerbyid?userid="+data[i].fromid,
				function(data){
					username = data.username;
				});
			//alert(username);
			$("#discussList").append("<div style='padding: 20px 0 20px 0; border-bottom: 1px solid #D2D2D2 ;'><div class='media-left'>"
						+"<img class='img-circle' src='img/adduser.ico' alt=''/>"
						+"<h5><a href='#'><span class='label label-default'>"+username+"</span></a></h5>"
						+"</div><div class='media-body response-text-right'>"
						+"<p>"+data[i].content+"</p>"
					    +"<ul><li>"+data[i].time.replace("T"," ")+"</li>"
						+"</ul>"
						+"</div><div class='clearfix'></div></div>");
		}
	});
}
function loadBlogger(){
	$.getJSON("./user_getbloggerbyid?userid="+GetUrlParms()["userid"],
		function(data){
			$("#bloggerImg").attr("src","images/fcrt3.jpg");
			$("#bloggerName").html("<a href=\"./blogger.html?userid="+data.uid+"\">"+data.username+"</a>");
			$("#world").text(data.word);
		}
	);
}

function loadBlogContent(){
	$.getJSON("./article_getarticlebyid?aid="+GetUrlParms()["aid"],
		function(data){
			//alert(data.content);
			var dianzan=0;
			$.get("./article_getdianzan?aid="+data.aid,null,function(data){
				$("#likeNum").text(data);
			});
			$("#title").text(data.title);
			$("#discussNum").text(discusslen);
			$("#viewNum").text(data.looktimes);
			$("#subTime").text(data.time.split("T")[0]);
			$("#articlecontent").html(data.content);
		});
	
}
function addDiscuss(){
	var content=$("#discussContent").val();
	if(userid==-1){
		alert("请先登录!");
	}else{
		//alert(content);
		$.get("./comment_addonecommentbyaid?aid="+GetUrlParms()["aid"]+"&content="+content,
		function(data){
			//alert(data);
			if(data.indexOf("success")!=-1){
				location.reload();
			}
		});
	}
}
//点赞
function dianzan(){
	if(dianzanstate!=0){
		alert("非常感谢您喜欢这篇文章，但您已经点过赞了！");
		return ;
	}
	$.get("./article_adddianzan?aid="+GetUrlParms()["aid"],null,
		function(data){
			if(data.indexOf("success")!=-1){
				$("#likeNum").text(parseInt($("#likeNum").text())+1);
				dianzanstate=1;
			}
		});
}
//打赏
function dashang(){
	if(userid==-1){
		alert("请先登录!");
		return;
	}
	$.get("./article_dashang?aid="+GetUrlParms()["aid"],null,
	function(data){
		alert(data);
	});
}
</script>
</body>
</html>